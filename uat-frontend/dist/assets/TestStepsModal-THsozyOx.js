import{_ as b,f,c as r,o as i,a as e,t as u,j as h,k as c,v as m,s as A,r as v,m as C,n as _,p as x,F as T,g as y}from"./index-DrsjAiDN.js";const g={props:{testCaseId:{type:Number,required:!0},stepToEdit:{type:Object,default:null}},data(){return{step:{step_number:1,description:"",expected_result:"",attachment:null},file:null}},watch:{stepToEdit:{immediate:!0,handler(s){s?this.step={...s}:this.resetForm()}}},methods:{resetForm(){this.step={step_number:1,description:"",expected_result:"",attachment:null},this.file=null},handleFileUpload(s){this.file=s.target.files[0]},async saveStep(){try{const s=new FormData;s.append("step_number",this.step.step_number),s.append("description",this.step.description),s.append("expected_result",this.step.expected_result),s.append("test_case",this.testCaseId),this.file&&s.append("attachment",this.file),this.stepToEdit?await f.put(`/test-steps/${this.stepToEdit.id}/`,s,{headers:{"Content-Type":"multipart/form-data"}}):await f.post("/test-steps/",s,{headers:{"Content-Type":"multipart/form-data"}}),this.$emit("saved"),this.closeModal()}catch(s){console.error("Error saving test step:",s),this.$emit("error",s)}},closeModal(){this.$emit("close")}}},k={class:"modal-overlay"},w={class:"modal-content"},U={class:"modal-title"},$={class:"form-group"},F={class:"form-group"},I={class:"form-group"},N={class:"form-group"},V={class:"form-group"},D={type:"submit",class:"btn btn-primary"};function q(s,t,p,S,o,n){return i(),r("div",k,[e("div",w,[e("h3",U,u(p.stepToEdit?"Edit Step":"Add Step"),1),e("form",{onSubmit:t[5]||(t[5]=h((...d)=>n.saveStep&&n.saveStep(...d),["prevent"]))},[e("div",$,[t[6]||(t[6]=e("label",{for:"stepNumber"},"Step Number",-1)),c(e("input",{type:"number",id:"stepNumber","onUpdate:modelValue":t[0]||(t[0]=d=>o.step.step_number=d),class:"form-control",required:""},null,512),[[m,o.step.step_number]])]),e("div",F,[t[7]||(t[7]=e("label",{for:"description"},"Description",-1)),c(e("textarea",{id:"description","onUpdate:modelValue":t[1]||(t[1]=d=>o.step.description=d),class:"form-control",required:""},null,512),[[m,o.step.description]])]),e("div",I,[t[8]||(t[8]=e("label",{for:"expectedResult"},"Expected Result",-1)),c(e("textarea",{id:"expectedResult","onUpdate:modelValue":t[2]||(t[2]=d=>o.step.expected_result=d),class:"form-control",required:""},null,512),[[m,o.step.expected_result]])]),e("div",N,[t[9]||(t[9]=e("label",{for:"attachment"},"Attachment",-1)),e("input",{type:"file",id:"attachment",onChange:t[3]||(t[3]=(...d)=>n.handleFileUpload&&n.handleFileUpload(...d)),class:"form-control"},null,32)]),e("div",V,[e("button",D,u(p.stepToEdit?"Update":"Save"),1),e("button",{type:"button",onClick:t[4]||(t[4]=(...d)=>n.closeModal&&n.closeModal(...d)),class:"btn btn-secondary"}," Cancel ")])],32)])])}const M=b(g,[["render",q],["__scopeId","data-v-6974a5d2"]]),R=A(),j={components:{AddTestStepModal:M},props:{testCase:Object,functionalities:{type:Array,default:()=>[]}},data(){return{localTestCase:{},showAddStepModal:!1}},watch:{testCase:{immediate:!0,handler(s){this.localTestCase=s?{...s}:{title:"",functionality_id:"",description:"",expected_result:""}}}},methods:{save(){this.$emit("save",this.localTestCase)},openAddStepModal(){if(!this.localTestCase.id){R.warning("Please save the test case before adding steps.");return}this.showAddStepModal=!0},closeAddStepModal(){this.showAddStepModal=!1},handleStepSaved(){this.closeAddStepModal(),this.$emit("step-saved")}}},B={class:"modal-content"},O={key:0},L={key:1},P={class:"form-group"},z={class:"form-group"},G=["value"],H={class:"form-group"},J={class:"form-group"},K={class:"form-buttons"};function Q(s,t,p,S,o,n){const d=v("AddTestStepModal");return i(),r("div",{class:"modal-overlay",onClick:t[7]||(t[7]=h(l=>s.$emit("close"),["self"]))},[e("div",B,[o.localTestCase.id?(i(),r("h3",O,"Edit Test Case")):(i(),r("h3",L,"Add New Test Case")),e("form",{onSubmit:t[6]||(t[6]=h((...l)=>n.save&&n.save(...l),["prevent"]))},[e("div",P,[t[8]||(t[8]=e("label",{for:"title"},"Test Case Title",-1)),c(e("input",{type:"text",id:"title","onUpdate:modelValue":t[0]||(t[0]=l=>o.localTestCase.title=l),class:"form-control",required:""},null,512),[[m,o.localTestCase.title]])]),e("div",z,[t[10]||(t[10]=e("label",{for:"functionality"},"Functionality",-1)),c(e("select",{id:"functionality","onUpdate:modelValue":t[1]||(t[1]=l=>o.localTestCase.functionality_id=l),class:"form-control",required:""},[t[9]||(t[9]=e("option",{value:"",disabled:""},"Select Functionality",-1)),(i(!0),r(T,null,y(p.functionalities,l=>(i(),r("option",{key:l.id,value:l.id},u(l.name),9,G))),128))],512),[[x,o.localTestCase.functionality_id]])]),e("div",H,[t[11]||(t[11]=e("label",{for:"description"},"Description",-1)),c(e("textarea",{id:"description","onUpdate:modelValue":t[2]||(t[2]=l=>o.localTestCase.description=l),class:"form-control"},null,512),[[m,o.localTestCase.description]])]),e("div",J,[t[12]||(t[12]=e("label",{for:"expected_result"},"Expected Result",-1)),c(e("input",{type:"text",id:"expected_result","onUpdate:modelValue":t[3]||(t[3]=l=>o.localTestCase.expected_result=l),class:"form-control",required:""},null,512),[[m,o.localTestCase.expected_result]])]),e("div",K,[t[13]||(t[13]=e("button",{type:"submit",class:"btn btn-primary"},"Create",-1)),e("button",{type:"button",onClick:t[4]||(t[4]=l=>s.$emit("close")),class:"btn btn-secondary"},"Cancel"),e("button",{type:"button",onClick:t[5]||(t[5]=(...l)=>n.openAddStepModal&&n.openAddStepModal(...l)),class:"btn btn-info"},"Add Step")])],32),o.showAddStepModal?(i(),C(d,{key:2,testCaseId:o.localTestCase.id,onClose:n.closeAddStepModal,onSaved:n.handleStepSaved},null,8,["testCaseId","onClose","onSaved"])):_("",!0)])])}const it=b(j,[["render",Q],["__scopeId","data-v-72917be6"]]),W={components:{AddTestStepModal:M},props:{testCase:Object},data(){return{showStepModal:!1,stepToEdit:null}},methods:{openAddStepModal(){this.stepToEdit=null,this.showStepModal=!0},openEditStepModal(s){this.stepToEdit={...s},this.showStepModal=!0},closeStepModal(){this.showStepModal=!1},async fetchTestSteps(){var s;if((s=this.testCase)!=null&&s.id)try{const t=await f.get(`/test-cases/${this.testCase.id}/`);this.$emit("update:testCase",t.data)}catch(t){console.error("Error fetching test steps:",t),this.$emit("error",t)}},async deleteStep(s){try{await f.delete(`/test-steps/${s}/`),this.fetchTestSteps()}catch(t){console.error("Error deleting test step:",t),this.$emit("error",t)}},handleError(s){console.error("Error in AddTestStepModal:",s),this.$emit("error",s)}},mounted(){this.fetchTestSteps()}},X={class:"modal-overlay"},Y={class:"modal-content"},Z={class:"modal-title"},tt={class:"table"},et=["href"],st={key:1},ot=["onClick"],lt=["onClick"];function nt(s,t,p,S,o,n){var l;const d=v("AddTestStepModal");return i(),r("div",X,[e("div",Y,[e("h3",Z,"Test Steps for "+u((l=p.testCase)==null?void 0:l.title),1),e("table",tt,[t[1]||(t[1]=e("thead",null,[e("tr",null,[e("th",null,"Step Number"),e("th",null,"Description"),e("th",null,"Expected Result"),e("th",null,"Attachment"),e("th",null,"Actions")])],-1)),e("tbody",null,[(i(!0),r(T,null,y(p.testCase.steps,a=>(i(),r("tr",{key:a.id},[e("td",null,u(a.step_number),1),e("td",null,u(a.description),1),e("td",null,u(a.expected_result),1),e("td",null,[a.attachment?(i(),r("a",{key:0,href:a.attachment,target:"_blank",class:"attachment-link"}," View Attachment ",8,et)):(i(),r("span",st,"No Attachment"))]),e("td",null,[e("button",{onClick:E=>n.openEditStepModal(a),class:"btn btn-warning btn-sm"},"Edit",8,ot),e("button",{onClick:E=>n.deleteStep(a.id),class:"btn btn-danger btn-sm"},"Delete",8,lt)])]))),128))])]),e("button",{onClick:t[0]||(t[0]=a=>s.$emit("close")),class:"btn btn-secondary"},"Close"),o.showStepModal?(i(),C(d,{key:0,testCaseId:p.testCase.id,stepToEdit:o.stepToEdit,onClose:n.closeStepModal,onSaved:n.fetchTestSteps,onError:n.handleError},null,8,["testCaseId","stepToEdit","onClose","onSaved","onError"])):_("",!0)])])}const rt=b(W,[["render",nt],["__scopeId","data-v-8e26c4b1"]]);export{M as A,rt as T,it as a};
