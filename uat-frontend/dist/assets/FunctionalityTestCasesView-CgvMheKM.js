import{_ as M,r as C,c,o as l,a as s,m as g,n as y,t as h,d as k,F as I,g as D,q as _,j as v,s as A,f as u}from"./index-DrsjAiDN.js";import{A as x,T as F,a as N}from"./TestStepsModal-THsozyOx.js";const r=A(),E={components:{TestCaseModal:N,TestStepsView:F,AddTestStepModal:x},data(){return{functionalityId:null,functionalityName:"",functionality:null,testCases:[],selectedTestCase:null,showModal:!1,showStepsModal:!1,showAddStepModal:!1,loading:!0,draggedItem:null,dragOverIndex:null}},methods:{async fetchTestCases(){this.loading=!0;try{const t=await u.get(`/test-cases/?functionality_id=${this.functionalityId}`);this.testCases=t.data.sort((e,d)=>e.sort_order-d.sort_order),console.log("Fetched test cases:",this.testCases)}catch(t){console.error("Error fetching test cases:",t),r.error("Failed to load test cases")}finally{this.loading=!1}},async fetchFunctionality(){try{const t=await u.get(`/functionalities/${this.functionalityId}/`);this.functionality=t.data,this.functionalityName=t.data.name}catch(t){console.error("Error fetching functionality details:",t),r.error("Failed to load functionality details")}},goBack(){this.$router.push("/admin/functionalities")},openCreateModal(){this.selectedTestCase={id:null,title:"",description:"",expected_result:"",functionality_id:this.functionalityId},this.showModal=!0},editTestCase(t){this.selectedTestCase={...t},this.showModal=!0},viewSteps(t){this.selectedTestCase={...t},this.showStepsModal=!0},addStep(t){this.selectedTestCase={...t},this.showAddStepModal=!0},closeModal(){this.showModal=!1,this.fetchTestCases()},closeTestSteps(){this.showStepsModal=!1},closeAddStepModal(){this.showAddStepModal=!1,this.fetchTestCases()},async saveTestCase(t){try{t.id?(await u.put(`/test-cases/${t.id}/`,t),r.success("Test case updated successfully")):(await u.post("/test-cases/",t),r.success("Test case created successfully")),this.closeModal()}catch(e){console.error("Error saving test case:",e),r.error("Error saving test case")}},async deleteTestCase(t){if(confirm("Are you sure you want to delete this test case?"))try{await u.delete(`/test-cases/${t}/`),this.testCases=this.testCases.filter(e=>e.id!==t),r.success("Test case deleted successfully")}catch(e){console.error("Error deleting test case:",e),r.error("Error deleting test case")}},handleStepSaved(){this.fetchTestCases()},getStatusClass(t){return{draft:"text-secondary",ready_for_testing:"text-primary",in_progress:"text-warning",completed:"text-success"}[t]||"text-secondary"},formatStatus(t){return{draft:"Draft",ready_for_testing:"Ready for Testing",in_progress:"In Progress",completed:"Completed"}[t]||t},formatDate(t){return t?new Date(t).toLocaleDateString():"N/A"},startDrag(t,e){this.draggedItem=e,t.dataTransfer.effectAllowed="move",t.target.classList.add("dragging")},onDrop(t,e){if(t.preventDefault(),this.dragOverIndex=null,this.draggedItem===e)return;const d=this.testCases[this.draggedItem].id,p=this.testCases.splice(this.draggedItem,1)[0];this.testCases.splice(e,0,p),this.updateTestCaseOrder(d,e)},async updateTestCaseOrder(t,e){try{await u.post("/test-cases/reorder/",{functionality_id:this.functionalityId,testcase_id:t,new_position:e}),r.success("Test case order updated"),this.fetchTestCases()}catch(d){console.error("Error reordering test cases:",d),r.error("Failed to update test case order"),this.fetchTestCases()}},onDragOver(t){this.dragOverIndex=t},onDragLeave(){this.dragOverIndex=null}},created(){if(this.functionalityId=parseInt(this.$route.params.functionalityId),this.functionalityName=this.$route.query.functionalityName||"Functionality",!this.functionalityId){r.error("Functionality ID is required"),this.$router.push("/admin/functionalities");return}this.fetchFunctionality(),this.fetchTestCases()}},B={class:"container mt-4"},O={class:"mb-4"},L={class:"mb-3"},V={class:"card"},q={class:"card-body"},j={class:"d-flex justify-content-between align-items-center mb-3"},z={key:0,class:"text-center py-4"},P={key:1,class:"table table-hover"},R=["onDragstart","onDrop"],G={class:"btn-group"},H=["onClick"],J=["onClick"],K=["onClick"],Q=["onClick"],U={key:2,class:"alert alert-info"};function W(t,e,d,p,o,a){var m,T;const S=C("TestCaseModal"),b=C("TestStepsView"),w=C("AddTestStepModal");return l(),c("div",B,[s("h2",O,"Test Cases for "+h(o.functionalityName),1),s("div",L,[s("button",{onClick:e[0]||(e[0]=(...n)=>a.goBack&&a.goBack(...n)),class:"btn btn-secondary"},e[4]||(e[4]=[s("i",{class:"fas fa-arrow-left"},null,-1),k(" Back to Functionalities ")]))]),s("div",V,[s("div",q,[s("div",j,[e[5]||(e[5]=s("h4",{class:"card-title"},"Test Cases",-1)),s("button",{onClick:e[1]||(e[1]=(...n)=>a.openCreateModal&&a.openCreateModal(...n)),class:"btn btn-primary"},"+ Add Test Case")]),o.loading?(l(),c("div",z,e[6]||(e[6]=[s("div",{class:"spinner-border",role:"status"},[s("span",{class:"visually-hidden"},"Loading...")],-1)]))):o.testCases.length>0?(l(),c("table",P,[e[8]||(e[8]=s("thead",{class:"table-dark"},[s("tr",null,[s("th",{width:"50"}),s("th",null,"Title"),s("th",null,"Status"),s("th",null,"Created At"),s("th",null,"Actions")])],-1)),s("tbody",null,[(l(!0),c(I,null,D(o.testCases,(n,f)=>(l(),c("tr",{key:n.id,draggable:"true",onDragstart:i=>a.startDrag(i,f),onDragover:e[2]||(e[2]=v(()=>{},["prevent"])),onDragenter:e[3]||(e[3]=v(()=>{},["prevent"])),onDrop:i=>a.onDrop(i,f),class:_({"drag-over":o.dragOverIndex===f})},[e[7]||(e[7]=s("td",{class:"drag-handle text-center"},[s("i",{class:"fas fa-grip-vertical"})],-1)),s("td",null,h(n.title),1),s("td",null,[s("span",{class:_(a.getStatusClass(n.status))},h(a.formatStatus(n.status)),3)]),s("td",null,h(a.formatDate(n.created_at)),1),s("td",null,[s("div",G,[s("button",{onClick:i=>a.editTestCase(n),class:"btn btn-warning btn-sm"},"Edit",8,H),s("button",{onClick:i=>a.viewSteps(n),class:"btn btn-info btn-sm"},"Steps",8,J),s("button",{onClick:i=>a.addStep(n),class:"btn btn-success btn-sm"},"+ Step",8,K),s("button",{onClick:i=>a.deleteTestCase(n.id),class:"btn btn-danger btn-sm"},"Delete",8,Q)])])],42,R))),128))])])):(l(),c("div",U,' No test cases found for this functionality. Click "Add Test Case" to create one. '))])]),o.showModal?(l(),g(S,{key:0,testCase:o.selectedTestCase,functionalities:[o.functionality],onClose:a.closeModal,onSave:a.saveTestCase},null,8,["testCase","functionalities","onClose","onSave"])):y("",!0),o.showStepsModal?(l(),g(b,{key:1,testCase:o.selectedTestCase,onClose:a.closeTestSteps},null,8,["testCase","onClose"])):y("",!0),o.showAddStepModal?(l(),g(w,{key:2,testCaseId:(m=o.selectedTestCase)==null?void 0:m.id,testCaseTitle:(T=o.selectedTestCase)==null?void 0:T.title,onClose:a.closeAddStepModal,onSaved:a.handleStepSaved},null,8,["testCaseId","testCaseTitle","onClose","onSaved"])):y("",!0)])}const Z=M(E,[["render",W],["__scopeId","data-v-53c73986"]]);export{Z as default};
