import{_ as M,c as u,o as i,a as s,F as y,g as S,t as c,q as w,f as r,j as v,k,p as N,r as p,b as V,m as T,n as g,s as E}from"./index-DrsjAiDN.js";import{A as F,T as U,a as $}from"./TestStepsModal-THsozyOx.js";const B={props:{testCases:Array,functionalities:Array},methods:{getFunctionalityName(e){var l;if((l=this.testCases.find(d=>d.functionality===e))!=null&&l.functionalityName)return this.testCases.find(d=>d.functionality===e).functionalityName;if(!e||!this.functionalities)return"N/A";const t=this.functionalities.find(d=>d.id===e);return t?t.name:"N/A"}}},D={class:"test-case-table"},I={class:"table-header"},O={class:"table table-hover"},j=["onClick"],x={class:"action-buttons"},z=["onClick"],L=["onClick"],W=["onClick"],q=["onClick"];function R(e,t,l,d,a,o){return i(),u("div",D,[s("div",I,[t[1]||(t[1]=s("h3",null,"📝 Test Cases",-1)),s("button",{onClick:t[0]||(t[0]=n=>e.$emit("openModal")),class:"btn btn-primary"},"+ Add Test Case")]),s("table",O,[t[2]||(t[2]=s("thead",{class:"table-dark"},[s("tr",null,[s("th",null,"Title"),s("th",null,"Functionality"),s("th",null,"Expected Result"),s("th",null,"Created By"),s("th",null,"Status"),s("th",null,"Actions")])],-1)),s("tbody",null,[(i(!0),u(y,null,S(l.testCases,n=>{var C,f,m;return i(),u("tr",{key:n.id},[s("td",null,c(n.title),1),s("td",null,c(o.getFunctionalityName((C=n.functionality)==null?void 0:C.id)),1),s("td",null,c(n.expected_result),1),s("td",null,c(((f=n.created_by)==null?void 0:f.first_name)||((m=n.created_by)==null?void 0:m.whatsapp_number)||"N/A"),1),s("td",null,[s("button",{class:w(["btn status-btn",n.assigned_user?"btn-success":"btn-secondary"]),onClick:h=>e.$emit("assign",n)},c(n.assigned_user?"Assigned":"Not Assigned"),11,j)]),s("td",null,[s("div",x,[s("button",{onClick:h=>e.$emit("edit",n),class:"btn btn-warning"},"✏️ Edit",8,z),s("button",{onClick:h=>e.$emit("delete",n.id),class:"btn btn-danger"},"🗑 Delete",8,L),s("button",{onClick:h=>e.$emit("viewSteps",n),class:"btn btn-info"},"📜 View Steps",8,W),s("button",{onClick:h=>e.$emit("addStep",n),class:"btn btn-info"},"➕ Add Step",8,q)])])])}),128))])])])}const G=M(B,[["render",R],["__scopeId","data-v-54613e70"]]),H={props:{testCase:Object},data(){return{testers:[],selectedUser:null}},async mounted(){const e=await r.get("/users/?role=tester");this.testers=e.data},methods:{assign(){this.$emit("assign",{testCaseId:this.testCase.id,userId:this.selectedUser})}}},J={class:"modal-overlay"},K={class:"modal-content"},P=["value"],Q={class:"form-buttons"};function X(e,t,l,d,a,o){return i(),u("div",J,[s("div",K,[t[5]||(t[5]=s("h3",null,"Assign Test Case",-1)),s("form",{onSubmit:t[2]||(t[2]=v((...n)=>o.assign&&o.assign(...n),["prevent"]))},[t[4]||(t[4]=s("label",null,"Select User",-1)),k(s("select",{"onUpdate:modelValue":t[0]||(t[0]=n=>a.selectedUser=n),class:"form-control"},[(i(!0),u(y,null,S(a.testers,n=>(i(),u("option",{key:n.id,value:n.id},c(n.first_name)+" - "+c(n.organization_name),9,P))),128))],512),[[N,a.selectedUser]]),s("div",Q,[t[3]||(t[3]=s("button",{type:"submit",class:"btn btn-primary"},"Assign",-1)),s("button",{type:"button",onClick:t[1]||(t[1]=n=>e.$emit("close")),class:"btn btn-secondary"},"Cancel")])],32)])])}const Y=M(H,[["render",X],["__scopeId","data-v-ed8254a6"]]),b=E(),Z={components:{TestCaseTable:G,TestCaseModal:$,TestCaseAssignmentModal:Y,TestStepsView:U,AddTestStepModal:F},data(){return{testCases:[],functionalities:[],selectedTestCase:null,showModal:!1,showAssignModal:!1,showStepsModal:!1,showAddStepModal:!1}},computed:{testCasesWithFunctionalityNames(){return this.testCases.map(e=>{const t=this.functionalities.find(l=>l.id===e.functionality);return{...e,functionalityName:t?t.name:"N/A"}})}},methods:{async fetchTestCases(){try{const e=await r.get("/test-cases/");this.testCases=e.data}catch(e){console.error("Error fetching test cases:",e)}},async fetchFunctionalities(){try{const e=await r.get("/functionalities/");this.functionalities=e.data}catch(e){console.error("Error fetching functionalities:",e)}},openCreateModal(){this.selectedTestCase=null,this.showModal=!0},editTestCase(e){this.selectedTestCase={...e},this.showModal=!0},openAssignModal(e){this.selectedTestCase={...e},this.showAssignModal=!0},openTestSteps(e){this.selectedTestCase={...e},this.showStepsModal=!0},openAddStepModal(e){this.selectedTestCase={...e},this.showAddStepModal=!0},closeModal(){this.showModal=!1,this.fetchTestCases()},closeAssignModal(){this.showAssignModal=!1,this.fetchTestCases()},closeTestSteps(){this.showStepsModal=!1},closeAddStepModal(){this.showAddStepModal=!1},async assignUser({testCaseId:e,userId:t}){try{await r.post(`/test-cases/${e}/assign/`,{userId:t}),this.closeAssignModal(),this.fetchTestCases(),b.success("User assigned successfully!")}catch(l){console.error("Error assigning user:",l),l.response?b.error("Error assigning user: "+l.response.data.error):b.error("An unexpected error occurred.")}},async deleteTestCase(e){confirm("Are you sure you want to delete this test case?")&&(await r.delete(`/test-cases/${e}/`),this.fetchTestCases())},async saveTestCase(e){e.id?await r.put(`/test-cases/${e.id}/`,e):await r.post("/test-cases/",e),this.closeModal()},handleStepSaved(){this.fetchTestCases()}},mounted(){this.fetchTestCases(),this.fetchFunctionalities()}},ee={class:"container mt-4"};function se(e,t,l,d,a,o){var A,_;const n=p("TestCaseTable"),C=p("TestCaseModal"),f=p("TestCaseAssignmentModal"),m=p("TestStepsView"),h=p("AddTestStepModal");return i(),u("div",ee,[t[0]||(t[0]=s("h2",{class:"mb-4"},"Test Case Management",-1)),V(n,{testCases:o.testCasesWithFunctionalityNames,functionalities:a.functionalities,onOpenModal:o.openCreateModal,onEdit:o.editTestCase,onDelete:o.deleteTestCase,onAssign:o.openAssignModal,onViewSteps:o.openTestSteps,onAddStep:o.openAddStepModal},null,8,["testCases","functionalities","onOpenModal","onEdit","onDelete","onAssign","onViewSteps","onAddStep"]),a.showModal?(i(),T(C,{key:0,testCase:a.selectedTestCase,functionalities:a.functionalities,onClose:o.closeModal,onSave:o.saveTestCase},null,8,["testCase","functionalities","onClose","onSave"])):g("",!0),a.showAssignModal?(i(),T(f,{key:1,testCase:a.selectedTestCase,onClose:o.closeAssignModal,onAssign:o.assignUser},null,8,["testCase","onClose","onAssign"])):g("",!0),a.showStepsModal?(i(),T(m,{key:2,testCase:a.selectedTestCase,onClose:o.closeTestSteps},null,8,["testCase","onClose"])):g("",!0),a.showAddStepModal?(i(),T(h,{key:3,testCaseId:(A=a.selectedTestCase)==null?void 0:A.id,testCaseTitle:(_=a.selectedTestCase)==null?void 0:_.title,onClose:o.closeAddStepModal,onSaved:o.handleStepSaved},null,8,["testCaseId","testCaseTitle","onClose","onSaved"])):g("",!0)])}const oe=M(Z,[["render",se]]);export{oe as default};
